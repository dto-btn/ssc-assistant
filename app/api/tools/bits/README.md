# BITS Documentation

This will document some of the steps of this PoC.

## EDR SQL Database optimisation.

### Indexing

```sql
-- Primary index for BR numbers (most frequently used in joins and filters)
CREATE NONCLUSTERED INDEX IX_DIM_DEMAND_BR_ITEMS_BR_NMBR
ON [EDR_CARZ].[DIM_DEMAND_BR_ITEMS] (BR_NMBR);

-- Index for snapshot table with period end date
CREATE NONCLUSTERED INDEX IX_FCT_DEMAND_BR_SNAPSHOT_BR_NMBR_PERIOD_END
ON [EDR_CARZ].[FCT_DEMAND_BR_SNAPSHOT] (BR_NMBR, PERIOD_END_DATE, STATUS_ID);

-- Index for OPIS table 
CREATE NONCLUSTERED INDEX IX_FCT_DEMAND_BR_OPIS_BR_NMBR_BUS_OPI
ON [EDR_CARZ].[FCT_DEMAND_BR_OPIS] (BR_NMBR, BUS_OPI_ID, PERSON_ID);

-- Index for products filtering
CREATE NONCLUSTERED INDEX IX_FCT_DEMAND_BR_PRODUCTS_BR_PROD_TYPE
ON [EDR_CARZ].[FCT_DEMAND_BR_PRODUCTS] (BR_NMBR, PROD_TYPE, PROD_ID);

-- For status filtering
CREATE NONCLUSTERED INDEX IX_DIM_BITS_STATUS_ACTIVE
ON [EDR_CARZ].[DIM_BITS_STATUS] (STATUS_ID, BR_ACTIVE_EN);

-- For person lookups
CREATE NONCLUSTERED INDEX IX_DIM_BITS_PERSON_ID
ON [EDR_CARZ].[DIM_BITS_PERSON] (PERSON_ID);

-- For product lookups
CREATE NONCLUSTERED INDEX IX_DIM_BITS_PRODUCT_ID
ON [EDR_CARZ].[DIM_BITS_PRODUCT] (PROD_ID);

CREATE NONCLUSTERED INDEX IX_FCT_DEMAND_BR_SNAPSHOT_PERIOD_STATUS
ON [EDR_CARZ].[FCT_DEMAND_BR_SNAPSHOT] (PERIOD_END_DATE, STATUS_ID, BR_NMBR);

-- Create a filtered index for the Active status
CREATE NONCLUSTERED INDEX IX_DIM_BITS_STATUS_ACTIVE_FILTERED
ON [EDR_CARZ].[DIM_BITS_STATUS] (STATUS_ID)
WHERE BR_ACTIVE_EN = 'Active';

CREATE NONCLUSTERED INDEX IX_FCT_DEMAND_BR_OPIS_COMPOSITE
ON [EDR_CARZ].[FCT_DEMAND_BR_OPIS] (BR_NMBR, BUS_OPI_ID, PERSON_ID);

-- Add supporting index on person table
CREATE NONCLUSTERED INDEX IX_DIM_BITS_PERSON_COVERING
ON [EDR_CARZ].[DIM_BITS_PERSON] (PERSON_ID);

-- Add supporting index on person table
CREATE NONCLUSTERED INDEX IX_FCT_DEMAND_BR_OPIS_BUS_PERSON
ON [EDR_CARZ].[FCT_DEMAND_BR_OPIS] (BUS_OPI_ID)
INCLUDE (BR_NMBR, PERSON_ID);

CREATE NONCLUSTERED INDEX IX_FCT_DEMAND_BR_PRODUCTS_TYPE_LEAD
ON [EDR_CARZ].[FCT_DEMAND_BR_PRODUCTS] (PROD_TYPE, BR_NMBR, PROD_ID)
WHERE PROD_TYPE = 'LEAD';  -- Filtered index for even better performance
```
